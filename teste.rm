use App\Models\Message;
use App\Events\NewMessage;

$message = Message::create([
    'user_id' => 1, // Substitua pelo ID do usuÃ¡rio real
    'sender_id' => 1, // Substitua pelo ID do usuÃ¡rio real
    'content' => 'Mensagem de teste!',
]);

event(new NewMessage($message));


use Pusher\Pusher;

$pusher = new Pusher(
    env('PUSHER_APP_KEY'),
    env('PUSHER_APP_SECRET'),
    env('PUSHER_APP_ID'),
    [
        'cluster' => env('PUSHER_APP_CLUSTER'),
        'useTLS' => true
    ]
);
Log::info('Evento sendo disparado');
$pusher->trigger('chat', 'NewMessage', ['content' => 'Teste manual via Pusher', 'sender_id' => 1]);


use Pusher\Pusher;

$pusher = new Pusher(
    env('PUSHER_APP_KEY'),
    env('PUSHER_APP_SECRET'),
    env('PUSHER_APP_ID'),
    [
        'cluster' => env('PUSHER_APP_CLUSTER'),
        'useTLS' => true
    ]
);

$pusher->trigger('chat', 'NewMessage', ['content' => 'Teste manual via Pusher']);


const socket = new WebSocket('ws://ws.pusherapp.com:6001/app/e8703bef27184bc00d2f?protocol=7&client=js&version=8.4.0');

socket.onopen = function(event) {
    console.log('ConexÃ£o WebSocket aberta:', event);
    socket.send('OlÃ¡, WebSocket!');
};

socket.onmessage = function(event) {
    console.log('Mensagem recebida:', event.data);
};

socket.onerror = function(event) {
    console.log('Erro no WebSocket:', event);
};

socket.onclose = function(event) {
    console.log('ConexÃ£o WebSocket fechada:', event);
};

const socket = new WebSocket("wss://ws-mt1.pusher.com/app/e8703bef27184bc00d2f?protocol=7&client=js&version=8.4.0");

socket.onopen = function(event) {
    console.log("âœ… Conectado ao WebSocket do Pusher:", event);
};

socket.onmessage = function(event) {
    console.log("ðŸ“© Mensagem recebida:", event.data);
};

socket.onerror = function(event) {
    console.log("âŒ Erro na conexÃ£o:", event);
};

socket.onclose = function(event) {
    console.log("ðŸ”Œ ConexÃ£o fechada:", event);
};

curl -i proconline.com.br 6001


var pusher = new Pusher('e8703bef27184bc00d2f', {
    cluster: 'mt1',
    encrypted: true
});
pusher.connection.bind('connected', function() {
    console.log('ðŸŸ¢ Conectado ao Pusher!');
});
pusher.connection.bind('error', function(err) {
    console.log('ðŸ”´ Erro no Pusher:', err);
});


server {
    listen 443 ssl http2;
    listen 80;

    server_name proconline.com.br www.proconline.com.br;
 
    root /var/www/public;

    client_max_body_size 51g;
    client_body_buffer_size 512k;
    client_body_in_file_only clean;

    ssl_certificate /etc/letsencrypt/live/proconline.com.br/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/proconline.com.br/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:AES>

 #   fastcgi_param HTTPS on;
#    fastcgi_param X-Forwarded-Proto $scheme;

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass app:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

    location /ws/ {
        proxy_pass http://127.0.0.1:6001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }


    location / {
        try_files $uri $uri/ /index.php?$query_string;
        gzip_static on;
    }

    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;
}
