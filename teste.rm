use App\Models\Message;
use App\Events\NewMessage;
$chatId = 1;
$message = Message::create([
    'user_id' => 1, // Substitua pelo ID do usuÃ¡rio real
    'sender_id' => 1, // Substitua pelo ID do usuÃ¡rio real
    'content' => 'Mensagem de teste!',
]);

event(new NewMessage($message, $chatId));


use Pusher\Pusher;

$pusher = new Pusher(
    env('PUSHER_APP_KEY'),
    env('PUSHER_APP_SECRET'),
    env('PUSHER_APP_ID'),
    [
        'cluster' => env('PUSHER_APP_CLUSTER'),
        'useTLS' => true
    ]
);
Log::info('Evento sendo disparado');
$pusher->trigger('chat', '.NewMessage', ['content' => 'Teste manual via Pusher', 'sender_id' => 1]);

wscat -c "wss://ws.pusherapp.com:443/app/e8703bef27184bc00d2f?protocol=7&client=js&version=8.4.0&flash=false"


use Pusher\Pusher;

$pusher = new Pusher(
    env('PUSHER_APP_KEY'),
    env('PUSHER_APP_SECRET'),
    env('PUSHER_APP_ID'),
    [
        'cluster' => env('PUSHER_APP_CLUSTER'),
        'useTLS' => true
    ]
);

$pusher->trigger('chat', 'NewMessage', ['content' => 'Teste manual via Pusher']);

use Pusher\Pusher;
$pusher = new Pusher(
    config('broadcasting.connections.pusher.key'),
    config('broadcasting.connections.pusher.secret'),
    config('broadcasting.connections.pusher.app_id'),
    [
        'cluster' => config('broadcasting.connections.pusher.options.cluster'),
        'useTLS' => true
    ]
);


const socket = new WebSocket('ws://ws.pusherapp.com:6001/app/e8703bef27184bc00d2f?protocol=7&client=js&version=8.4.0');

socket.onopen = function(event) {
    console.log('ConexÃ£o WebSocket aberta:', event);
    socket.send('OlÃ¡, WebSocket!');
};

socket.onmessage = function(event) {
    console.log('Mensagem recebida:', event.data);
};

socket.onerror = function(event) {
    console.log('Erro no WebSocket:', event);
};

socket.onclose = function(event) {
    console.log('ConexÃ£o WebSocket fechada:', event);
};

const socket = new WebSocket("wss://ws-mt1.pusher.com/app/e8703bef27184bc00d2f?protocol=7&client=js&version=8.4.0");

socket.onopen = function(event) {
    console.log("âœ… Conectado ao WebSocket do Pusher:", event);
};

socket.onmessage = function(event) {
    console.log("ðŸ“© Mensagem recebida:", event.data);
};

socket.onerror = function(event) {
    console.log("âŒ Erro na conexÃ£o:", event);
};

socket.onclose = function(event) {
    console.log("ðŸ”Œ ConexÃ£o fechada:", event);
};

curl -i proconline.com.br 6001


var pusher = new Pusher('e8703bef27184bc00d2f', {
    cluster: 'mt1',
    encrypted: true
});
pusher.connection.bind('connected', function() {
    console.log('ðŸŸ¢ Conectado ao Pusher!');
});
pusher.connection.bind('error', function(err) {
    console.log('ðŸ”´ Erro no Pusher:', err);
});


server {
    listen 443 ssl http2;
    listen 80;

    server_name proconline.com.br www.proconline.com.br;
 
    root /var/www/public;

    client_max_body_size 51g;
    client_body_buffer_size 512k;
    client_body_in_file_only clean;

    ssl_certificate /etc/letsencrypt/live/proconline.com.br/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/proconline.com.br/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:AES>

 #   fastcgi_param HTTPS on;
#    fastcgi_param X-Forwarded-Proto $scheme;

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass app:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

    location /ws/ {
        proxy_pass http://127.0.0.1:6001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }


    location / {
        try_files $uri $uri/ /index.php?$query_string;
        gzip_static on;
    }

    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;
}


wscat -c "wss://proconline.com.br/ws/"


curl -X POST https://proconline.com.br/broadcasting/auth \
     -H "Authorization: Bearer SEU_TOKEN" \
     -H "Content-Type: application/json"

curl -X POST -H "Authorization: Bearer SEU_TOKEN" https://proconline.com.br/broadcasting/auth

curl -X POST https://proconline.com.br/broadcasting/auth \
  -H "X-CSRF-TOKEN: eyJpdiI6ImZrL1dYZ0hmN1BDdlpyUUM3MFY5QUE9PSIsInZhbHVlIjoiUzZqRzYyVHdGcHhMRjUrNDBRcTAvY1NyUndPTGVzWkZmZkwrTWFubUEwMkwzWUk3T1ZlbloyR1RyRHA5S2RwRHlhQjdWWjVaSC9tZXZhN1RVTjI1VGlaZVhhNklYWk5GLzFLSDdoUzdZaWNJQ1VXWkNDVkFuWnNHSUtTSHR3NmkiLCJtYWMiOiJjZmQwYWY0NWFkZDdkOWIyZmJlODRlZjhjMGE0N2M5ZGY4ZDcyZWJmYzUzMzM4NDIzMmYwNGRkYzE3MDQ4MzZjIiwidGFnIjoiIn0%3D" \
  -H "Cookie: eyJpdiI6IjZ4TU9xdzlDOEVhLzcxVXJhWjlsL1E9PSIsInZhbHVlIjoiUDIrZndJemlMejYzTEtLQjl1d3hkUGhPREN0dm5OYm5oMlN1bUM5YVVMMEhXVzlPdU9NVDhFb3R1MlZXclRQNmFvQWpqa0FYTG93QUdROVArOE5JdHVWN3Nhd1VLQXQyRjJnQVBHdlpwbGs3OUtPcklRTlVRRStNaE01bUtiRlAiLCJtYWMiOiI2MTE4MzJkYTA1ZTE1YmY5ODhmMTNlODU4NTIzMDIxZTdmMjEyZWU4MjE4ZTMyZGE2YzNmYmI1ODY3OWVhMzJmIiwidGFnIjoiIn0%3D" \
  -H "Content-Type: application/json" \
  --data '{"socket_id":"1234.5678","channel_name":"private-chat.1"}'

curl -X POST https://proconline.com.br/broadcasting/auth \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer e8703bef27184bc00d2f:f2a64a5bdb719a5af1d96c70cca0aaf023cf0e0a685560c5faa6e9317329df4d" \
  --data '{"socket_id":"1234.5678","channel_name":"private-chat.1"}'

curl -X POST https://proconline.com.br/login \
  -H "Content-Type: application/json" \
  --data '{
    "email": "andersonqipoa@gmail.com",
    "password": "12345678"
  }'

curl -X POST https://proconline.com.br/login \
  -H "Content-Type: application/json" \
  -H "X-CSRF-TOKEN: TdysEQMNOiYYnKIbMkGNX8EUslwHXswYBCBT01Gl" \
  --data '{
    "email": "andersonqipoa@gmail.com",
    "password": "12345678"
  }'

curl -X POST https://proconline.com.br/broadcasting/auth

curl -X POST https://proconline.com.br/broadcasting/auth \
  -b cookies.txt \
  -H "X-CSRF-TOKEN: TdysEQMNOiYYnKIbMkGNX8EUslwHXswYBCBT01Gl"


$message = \App\Models\Message::create([
    'content' => 'Mensagem de Teste',
    'sender_id' => 1,
]);


broadcast(new \App\Events\NewMessage($message, 5));

curl -H 'Content-Type: application/json' -d '{"data":"{\"message\":\"hello world\"}","name":"my-event","channel":"my-channel"}' \
"https://api-mt1.pusher.com/apps/1920745/events?"\
"body_md5=2c99321eeba901356c4c7998da9be9e0&"\
"auth_version=1.0&"\
"auth_key=e8703bef27184bc00d2f&"\
"auth_timestamp=1743346520&"\
"auth_signature=fb62c8e2bf350f4bc56ea4ab2c6acda61608f45539b38193c5fcb745aa0c6d19&"